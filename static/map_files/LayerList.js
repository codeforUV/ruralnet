// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See https://js.arcgis.com/3.35/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/LayerList/templates/LayerList.html":'\x3cdiv class\x3d"${theme}" role\x3d"presentation"\x3e\r\n  \x3cdiv role\x3d"menu" data-dojo-attach-point\x3d"_container" class\x3d"${css.container}"\x3e\r\n    \x3cul role\x3d"group" class\x3d"${css.list}" data-dojo-attach-point\x3d"_layersNode"\x3e\x3c/ul\x3e\r\n    \x3cdiv class\x3d"${css.noLayersText}" data-dojo-attach-point\x3d"_noLayersNode"\x3e\x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/LayerList","dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel ../kernel dojo/uacss dojo/Deferred dojo/on dojo/query dojo/dom-class dojo/dom-style dojo/dom-construct dojo/dom-attr dojo/i18n!../nls/jsapi dijit/a11yclick dijit/_WidgetBase dijit/_TemplatedMixin ../promiseList ../layerUtils dojo/text!./LayerList/templates/LayerList.html".split(" "),function(q,D,p,R,S,T,L,r,E,l,M,k,m,x,N,U,V,W,X,Y){function H(a){var b=a.layer,c=a.nodes;a=a.className;b=b.getMap()?b.visibleAtMapScale:
!0;var d=c.checkbox;c=c.layer;l.toggle(c,a,!b);b?(m.remove(c,"aria-disabled"),m.remove(d,"disabled")):(m.set(c,"aria-disabled","true"),m.set(d,"disabled","disabled"))}var Z=q.some(["ar","he"],function(a){return-1!==R.locale.indexOf(a)});D=D([U,V],{templateString:Y,defaults:{theme:"esriLayerList",map:null,layers:null,showSubLayers:!0,showOpacitySlider:!1,showLegend:!1,removeUnderscores:!0,visible:!0},constructor:function(a){a=p.mixin({},this.defaults,a);this.set(a);this.css={container:"esriContainer",
noLayers:"esriNoLayers",noLayersText:"esriNoLayersText",slider:"esriSlider",sliderLabels:"esriSliderLabels",legend:"esriLegend",tabContainer:"esriTabContainer",tabs:"esriTabs",tabMenu:"esriTabMenu",tabMenuItem:"esriTabMenuItem",tabMenuSelected:"esriTabMenuSelected",tabMenuVisible:"esriTabMenuVisible",tab:"esriTab",tabSelected:"esriTabSelected",toggleButton:"esriToggleButton",iconCollapse:"esri-icon-down",iconExpand:Z?"esri-icon-left":"esri-icon-right",list:"esriList",listExpand:"esriListExpand",subListExpand:"esriSubListExpand",
listVisible:"esriListVisible",subList:"esriSubList",hasSubList:"esriHasSubList",hasButton:"esriHasButton",hasTabContent:"esriHasTabContent",subListLayer:"esriSubListLayer",layer:"esriLayer",layerScaleInvisible:"esriScaleInvisible",title:"esriTitle",titleContainer:"esriTitleContainer",checkbox:"esriCheckbox",label:"esriLabel",button:"esriButton",content:"esriContent",clearFix:"esriClearFix",clear:"esriClear"}},postCreate:function(){this.inherited(arguments);var a=this;this.own(r(this._layersNode,r.selector("."+
this.css.checkbox,"change"),function(){var b=m.get(this,"data-layer-index");var c=m.get(this,"data-sublayer-index");a._toggleLayer(b,c);a._toggleState(b,c)}));this.own(r(this._layersNode,r.selector("."+this.css.tabMenuItem,N.press),function(){var b=m.get(this,"data-layer-index"),c=m.get(this,"data-tab-id");a._toggleTab(b,c)}));this.own(r(this._layersNode,r.selector("."+this.css.toggleButton,N.press),function(){var b=m.get(this,"data-layer-index");a._toggleExpand(b)}))},startup:function(){this.inherited(arguments);
this._mapLoaded(this.map).then(p.hitch(this,this._init))},destroy:function(){this._removeEvents();this.inherited(arguments)},refresh:function(){var a=this.layers;this._nodes=[];var b=[];if(a&&a.length)for(var c=0;c<a.length;c++)b.push(this._layerLoaded(c));return W(b).always(p.hitch(this,function(d){this._loadedLayers=d;this._removeEvents();this._createLayerNodes();this._setLayerEvents();this.emit("refresh")}))},_mapLoaded:function(a){var b=new L;if(a)if(a.loaded)b.resolve();else r.once(a,"load",
p.hitch(this,function(){b.resolve()}));else b.resolve();return b.promise},_toggleExpand:function(a){a=parseInt(a,10);if(a=this._nodes[a]){var b=a.layer;l.toggle(b,this.css.listExpand);b=l.contains(b,this.css.listExpand);m.set(a.toggle,"title",b?x.widgets.layerList.collapse:x.widgets.layerList.expand);l.toggle(a.toggle,this.css.iconCollapse,b);l.toggle(a.toggle,this.css.iconExpand,!b)}},_toggleTab:function(a,b){a=parseInt(a,10);if(a=this._nodes[a]){var c=a.tabMenu;a=E("[data-tab-id]",a.tabs);c=E("[data-tab-id]",
c);var d;for(d=0;d<a.length;d++){var e=m.get(a[d],"data-tab-id");l.toggle(a[d],this.css.tabSelected,b===e)}for(d=0;d<c.length;d++)a=m.get(c[d],"data-tab-id"),l.toggle(c[d],this.css.tabMenuSelected,b===a)}},_layerLoaded:function(a){var b=this.layers[a],c=b.layer,d={layer:c,layerInfo:b,layerIndex:a},e=new L;if(c)if(c.loaded)e.resolve(d);else if(c.loadError)e.reject(c.loadError);else{var f=r.once(c,"load",p.hitch(this,function(){g.remove();e.resolve(d)}));var g=r.once(c,"error",p.hitch(this,function(h){f.remove();
e.reject(h)}))}else e.resolve(d);return e.promise},_checkboxStatus:function(a){return!!a.visibility},_WMSVisible:function(a,b){var c=[];a&&a.layer&&(c=a.layer.visibleLayers);return-1<q.indexOf(c,b.name)},_subCheckboxStatus:function(a,b){switch(a.layer.declaredClass){case "esri.layers.KMLLayer":a=b.visible;break;case "esri.layers.WMSLayer":a=this._WMSVisible(a,b);break;default:a=b.defaultVisibility}return!!a},_getLayerTitle:function(a){var b="",c=a.layer;(a=a.layerInfo)&&a.title?b=a.title:c&&c.arcgisProps&&
c.arcgisProps.title?b=c.arcgisProps.title:c&&c.name?b=c.name:a&&a.id?b=a.id:c&&c.id&&(b=c.id);return this.removeUnderscores?b.replace(/_/g," "):b},_showSublayers:function(a){return a.hasOwnProperty("showSubLayers")?a.showSubLayers:this.showSubLayers},_opacityChange:function(a){if(this.layer)this.layer.setOpacity(a);else if(this.layers)for(var b=0;b<this.layers.length;b++)this.layers[b].layerObject&&this.layers[b].layerObject.setOpacity(a)},_legend:function(a,b,c){var d=k.create("div",{role:"tabpanel",
"data-tab-id":"legend",className:this.css.tab+" "+this.css.legend},a);require(["esri/dijit/Legend"],p.hitch(this,function(e){var f=[b];if(b&&b.featureCollection&&b.featureCollection.layers){f=b.featureCollection.layers;for(var g=0;g<f.length;g++)f[g].layer=f[g].layerObject}e=new e({map:this.map,layerInfos:f},k.create("div"));k.place(e.domNode,d);e.startup();this._nodes[c].legend=e}))},_slider:function(a,b,c,d){a=k.create("div",{role:"tabpanel","data-tab-id":"opacity",className:this.css.tab+" "+this.css.slider},
a);var e=k.create("div",{},a),f=k.create("div",{},a);require(["dijit/form/HorizontalSlider","dijit/form/HorizontalRuleLabels"],p.hitch(this,function(g,h){g=new g({showButtons:!1,minimum:.1,maximum:1,layer:b,layers:c,discreteValues:.1,intermediateChanges:!0,value:d,onChange:this._opacityChange},e);h=new h({container:"bottomDecoration",count:0,className:this.css.sliderLabels,labels:["0","50","100"]},f);g.startup();h.startup()}))},_createLayerNodes:function(){this._layersNode.innerHTML="";this._noLayersNode.innerHTML=
"";l.remove(this._container,this.css.noLayers);var a=this._loadedLayers;if(a&&a.length)for(var b=0;b<a.length;b++){var c=a[b];if(c){var d=c.layer,e=c.layerIndex,f=c.layerInfo;if(f){if(f.featureCollection&&!f.hasOwnProperty("visibility")){var g=f.featureCollection.layers[0];g&&g.layerObject&&(f.visibility=g.layerObject.visible)}d&&!f.hasOwnProperty("visibility")&&(f.visibility=f.layer.visible);d&&!f.hasOwnProperty("id")&&(f.id=f.layer.id);g=k.create("li",{role:"menuitem",className:this.css.layer});
k.place(g,this._layersNode,"first");var h=k.create("div",{className:this.css.title},g);var w=k.create("div",{className:this.css.tabContainer},g),B=k.create("ul",{role:"tablist",className:this.css.tabMenu+" "+this.css.clearFix},w);w=k.create("div",{className:this.css.tabs},w);var O=[];if(d)var y=d.declaredClass;var t=this._checkboxStatus(f),u=k.create("div",{className:this.css.titleContainer},h),n=this.id+"_checkbox_"+e,z=k.create("input",{type:"checkbox",id:n,"data-layer-index":e,className:this.css.checkbox},
u);m.set(z,"checked",t);var v=k.create("div",{tabindex:0,role:"button","data-layer-index":e,title:x.widgets.layerList.expand,className:this.css.toggleButton+" "+this.css.iconExpand},u);if(f.button){var I=f.button;l.add(g,this.css.hasButton);l.add(I,this.css.button);k.place(I,u)}c=this._getLayerTitle(c);c=k.create("label",{className:this.css.label,textContent:c},u);m.set(c,"for",n);n=k.create("div",{className:this.css.clear},u);if(f.content){var J=f.content;l.add(J,this.css.content);k.place(J,h)}h=
{checkbox:z,title:h,tabMenu:B,tabs:w,titleContainer:u,label:c,layer:g,toggle:v,clear:n,button:I,content:J,subNodes:O};this._nodes[e]=h;l.toggle(g,this.css.listVisible,t);if(d&&(H({layer:d,className:this.css.layerScaleInvisible,nodes:h}),h=d.layerInfos,"esri.layers.KMLLayer"===y&&(h=d.folders),u=this._showSublayers(f),"esri.layers.ArcGISTiledMapServiceLayer"!==y&&h&&h.length))if(u){k.create("li",{tabindex:0,"data-tab-id":"sublayers","data-layer-index":e,role:"tab",className:this.css.tabMenuItem,textContent:x.widgets.layerList.sublayers},
B);l.add(g,this.css.hasSubList);l.toggle(g,this.css.subListExpand,t);t=k.create("div",{className:this.css.tab,"data-tab-id":"sublayers",role:"tabpanel"},w);u=k.create("ul",{role:"group",className:this.css.subList},t);var P;z=[];for(t=0;t<h.length;t++){c=h[t];n=-1;v=null;if("esri.layers.ArcGISDynamicMapServiceLayer"===y){var C=c.id;n=c.parentLayerId;c.subLayerIds||(c.defaultVisibility=d&&d.visibleLayers&&-1!==d.visibleLayers.indexOf(c.id)?!0:!1)}else"esri.layers.KMLLayer"===y?(C=c.id,n=c.parentFolderId):
"esri.layers.WMSLayer"===y&&(C=c.name,n=-1);if(-1!==n)if(v=this._nodes[e].subNodes[n],z[n])v=z[n];else{var A=v.subLayer;v=k.create("ul",{role:"group",className:this.css.subList},A);l.add(A,this.css.hasSubList);l.toggle(A,[this.css.listVisible,this.css.subListExpand],K);z[n]=v}var K=this._subCheckboxStatus(f,c);K&&!P&&(P=!0);var F=this.id+"_checkbox_sub_"+e+"_"+C;n=k.create("li",{role:"menuitem",className:this.css.subListLayer},v||u);A=k.create("div",{className:this.css.title},n);var G=k.create("div",
{className:this.css.titleContainer},A),Q=k.create("input",{type:"checkbox",id:F,"data-layer-index":e,"data-sublayer-index":C,className:this.css.checkbox},G);m.set(Q,"checked",K);c=k.create("label",{className:this.css.label,textContent:c.title||c.name||""},G);m.set(c,"for",F);F=k.create("div",{className:this.css.clear},G);O[C]={subList:u,subSubList:v,subLayer:n,subTitle:A,subTitleContainer:G,subCheckbox:Q,subLabel:c,subClear:F}}}else for(t=0;t<h.length;t++)c=h[t],n=-1,"esri.layers.ArcGISDynamicMapServiceLayer"===
y&&(n=c.parentLayerId,c.subLayerIds||(c.defaultVisibility=d&&d.visibleLayers&&-1!==d.visibleLayers.indexOf(c.id)?!0:!1));if(f.hasOwnProperty("showLegend")?f.showLegend:this.showLegend)k.create("li",{tabindex:0,role:"tab",className:this.css.tabMenuItem,"data-layer-index":e,"data-tab-id":"legend",textContent:x.widgets.layerList.legend},B),this._legend(w,f,e);if(f.hasOwnProperty("showOpacitySlider")?f.showOpacitySlider:this.showOpacitySlider){if(!d&&f.featureCollection){var aa=f.featureCollection.layers;
f=f.featureCollection.layers[0].opacity}else f=d.opacity;k.create("li",{tabindex:0,"data-tab-id":"opacity",role:"tab",className:this.css.tabMenuItem,"data-layer-index":e,textContent:x.widgets.layerList.opacity},B);this._slider(w,d,aa,f)}d=E("."+this.css.tab,w);if(e=d.length)l.add(g,[this.css.hasTabContent]),l.add(d[0],this.css.tabSelected);1<e&&(l.add(g,this.css.tabMenuVisible),g=E("li",B),g.length&&l.add(g[0],this.css.tabMenuSelected))}}}else l.add(this._container,this.css.noLayers),m.set(this._noLayersNode,
"textContent",x.widgets.layerList.noLayers)},_removeEvents:function(){if(this._layerEvents&&this._layerEvents.length)for(var a=0;a<this._layerEvents.length;a++)this._layerEvents[a].remove();this._layerEvents=[]},_emitToggle:function(a,b,c){this.emit("toggle",{layerIndex:a,subLayerIndex:b,visible:c})},_toggleVisible:function(a,b){var c=this._nodes[a].checkbox;l.toggle(this._nodes[a].layer,this.css.listVisible,b);var d=m.get(c,"checked");l.contains(this._nodes[a].layer,this.css.hasSubList)&&l.toggle(this._nodes[a].layer,
this.css.subListExpand,d);d!==b&&(m.set(c,"checked",b),this._emitToggle(a,null,b))},_layerVisChangeEvent:function(a,b,c){var d=b?a.layerInfo.featureCollection.layers[c].layer:a.layer;c=r(d,"visibility-change",p.hitch(this,function(g){var h=this.layers&&this.layers[a.layerIndex];h&&(h.visibility=g.visible);b?this._featureCollectionVisible(a.layerIndex,g.visible):this._toggleVisible(a.layerIndex,g.visible)}));this._layerEvents.push(c);if(!b){var e=this._nodes[a.layerIndex],f=this.css.layerScaleInvisible;
H({nodes:e,className:f,layer:d});c=r(d,"scale-visibility-change",p.hitch(this,function(g){H({nodes:e,className:f,layer:d})}));this._layerEvents.push(c);"esri.layers.ArcGISDynamicMapServiceLayer"===d.declaredClass&&(c=r(this.map,"zoom-end",p.hitch(this,function(){this._subLayerScale(a)})),this._layerEvents.push(c),this._subLayerScale(a))}},_subLayerScale:function(a){var b=a.layer.createDynamicLayerInfosFromLayerInfos(),c=X._getLayersForScale(this.map.getScale(),b);q.forEach(b,p.hitch(this,function(d){if(!d.subLayerIds){d=
d.id;var e=this._nodes[a.layerIndex].subNodes[d];if(e){var f=e.subLayer;e=e.subCheckbox;var g=!1;-1===q.indexOf(c,d)&&(g=!0);l.toggle(f,this.css.layerScaleInvisible,g);g?(m.set(f,"aria-disabled","true"),m.set(e,"disabled","disabled")):(m.remove(f,"aria-disabled"),m.remove(e,"disabled"))}}}))},_layerEvent:function(a){var b=a.layerInfo;if(b.featureCollection&&b.featureCollection.layers&&b.featureCollection.layers.length){if((b=b.featureCollection.layers)&&b.length)for(var c=0;c<b.length;c++)this._layerVisChangeEvent(a,
!0,c)}else this._layerVisChangeEvent(a)},_getVisibleLayers:function(a,b){var c=a.layerInfos,d=[-1];"undefined"!==typeof b&&(b=this._getLayerInfo(a,b),b.defaultVisibility=!b.defaultVisibility);for(b=0;b<c.length;b++){var e=c[b];e.defaultVisibility&&(d.push(e.id),e=q.lastIndexOf(d,-1),-1!==e&&d.splice(e,1))}c=[];for(b=0;b<d.length;b++)e=d[b],this._allIdsPresent(a,e,d)&&c.push(e);d=[];for(b=0;b<c.length;b++)(e=this._getLayerInfo(a,c[b]))&&null===e.subLayerIds&&d.push(c[b]);d.length||(d=[-1]);return d},
_toggleState:function(a,b){a=parseInt(a,10);var c=this._nodes[a];c.legend&&c.legend.refresh();null!==b?(b=parseInt(b,10),a=c.subNodes[b].subLayer,b=c.subNodes[b].subCheckbox):(a=c.layer,b=c.checkbox);b=m.get(b,"checked");l.contains(a,this.css.hasSubList)&&l.toggle(a,this.css.subListExpand,b);l.toggle(a,this.css.listVisible,b)},_toggleLayer:function(a,b){if(this.layers&&this.layers.length){a=parseInt(a,10);var c=this.layers[a],d=c.layer,e=d&&d.layerInfos;if(d)var f=d.declaredClass;var g=c.featureCollection;
if(g){var h=!c.visibility;c.visibility=h;for(c=0;c<g.layers.length;c++)g.layers[c].layerObject.setVisibility(h)}else if(d)if(null!==b){if("esri.layers.ArcGISDynamicMapServiceLayer"===f)b=parseInt(b,10),g=this._getVisibleLayers(d,b),d.setVisibleLayers(g);else if("esri.layers.KMLLayer"===f)for(b=parseInt(b,10),g=d.folders,c=0;c<g.length;c++){if(f=g[c],f.id===b){d.setFolderVisibility(f,!f.visible);break}}else"esri.layers.WMSLayer"===f&&(g=d.visibleLayers,c=q.indexOf(g,b),-1===c?g.push(b):g.splice(c,
1),d.setVisibleLayers(g));e&&(h=this._getLayerInfo(d,b).defaultVisibility)}else"esri.layers.ArcGISDynamicMapServiceLayer"===f&&(g=this._getVisibleLayers(d),d.setVisibleLayers(g)),h=!d.visible,c.visibility=h,d.setVisibility(h);else h=!c.visible,c.setVisibility(h);this._emitToggle(a,b,h)}},_featureCollectionVisible:function(a,b){var c=this.layers[a],d=c.visibleLayers,e=c.featureCollection.layers;(d&&d.length?q.every(d,function(f){return e[f].layer.visible===b}):q.every(e,function(f){return f.layer.visible===
b}))&&this._toggleVisible(a,b)},_setLayerEvents:function(){var a=this._loadedLayers;a&&a.length&&q.forEach(a,function(b,c){var d=b.layer;d&&(d.getMap()?this._layerEvent(b):(c=r(this.map,"layer-add-result",p.hitch(this,function(e){e.layer===d&&this._layerEvent(b)})),this._layerEvents.push(c)))},this)},_allIdsPresent:function(a,b,c){a=this._walkUpLayerIds(a,b);return q.every(a,function(d){return-1<q.indexOf(c,d)})},_walkUpLayerIds:function(a,b){var c=this._getLayerInfo(a,b);b=[];if(c)for(;-1!==c.parentLayerId;)(c=
this._getLayerInfo(a,c.parentLayerId))&&b.push(c.id);return b},_getLayerInfo:function(a,b){for(var c,d=0;d<a.layerInfos.length;d++){var e=a.layerInfos[d];if(e.id===b){c=e;break}}return c},_isSupportedLayerType:function(a){return a&&!a._basemapGalleryLayerType||a&&"basemap"!==a._basemapGalleryLayerType},_createLayerInfo:function(a){return{layer:a}},_updateAllMapLayers:function(){if(this.map&&(!this.layers||!this.layers.length)){var a=[];q.forEach(this.map.layerIds,function(b){b=this.map.getLayer(b);
this._isSupportedLayerType(b)&&a.push(this._createLayerInfo(b))},this);q.forEach(this.map.graphicsLayerIds,function(b){b=this.map.getLayer(b);this._isSupportedLayerType(b)&&b._params&&b._params.drawMode&&a.push(this._createLayerInfo(b))},this);this._set("layers",a)}},_init:function(){this._visible();this._updateAllMapLayers();this.refresh().always(p.hitch(this,function(){this.set("loaded",!0);this.emit("load")}))},_visible:function(){this.visible?M.set(this.domNode,"display","block"):M.set(this.domNode,
"display","none")},_setThemeAttr:function(a){this.domNode&&(l.remove(this.domNode,this.theme),l.add(this.domNode,a));this._set("theme",a)},_setMapAttr:function(a){this._set("map",a);this._created&&this._mapLoaded(this.map).then(p.hitch(this,function(){this._updateAllMapLayers();this.refresh()}))},_setLayersAttr:function(a){this._set("layers",a);this._created&&this.refresh()},_setRemoveUnderscoresAttr:function(a){this._set("removeUnderscores",a);this._created&&this.refresh()},_setShowSubLayersAttr:function(a){this._set("showSubLayers",
a);this._created&&this.refresh()},_setShowOpacitySliderAttr:function(a){this._set("showOpacitySlider",a);this._created&&this.refresh()},_setShowLegendAttr:function(a){this._set("showLegend",a);this._created&&this.refresh()},_setVisibleAttr:function(a){this._set("visible",a);this._created&&this._visible()}});T("extend-esri")&&p.setObject("dijit.LayerList",D,S);return D});